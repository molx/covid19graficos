function dateToDM(a){var b=a.getDate(),c=a.getMonth()+1;return""+(9>=b?"0"+b:b)+"/"+(9>=c?"0"+c:c)}function isArray(a){return"[object Array]"===Object.prototype.toString.call(a)}function splat(a){return isArray(a)?a:[a]}function formatToChart(a,b,c="date"){const d=[...new Set(a.map(a=>a.location))];let e=[];return d.forEach(function(d){let f=a.filter(function(a){return a.location==d}),g=[];f.forEach(function(a){a[b]&&("date"==c?g.push([Date.parse(a[c]),a[b]]):g.push([a[c],a[b]]))}),e.push({name:d,data:g})}),e}function formatToColumnChart(a,b,c){let d=[{data:[]}];const e=Object.values(a).reduce((d,a)=>+d+a[c],0);for(i=0;i<a.length;i++){let f=Math.round(1e4*a[i][c]/e)/100;d[0].data.push({name:a[i][b],y:a[i][c],color:myColors[i],pct:f})}d[0].data.sort((c,a)=>parseFloat(a.y)-parseFloat(c.y));let f=[...new Set(d[0].data.map(a=>a.name))];return{series:d,order:f}}function summarise(a,b,c,d,e,f=!1){sums={};for(let g=0;g<a.length;g++)sums[a[g][b]]?sums[a[g][b]]+=a[g][c]:sums[a[g][b]]=a[g][c];var g={},h=[];for(i=0;i<Object.keys(sums).length;i++){let a=Object.assign({},g),j=Object.keys(sums)[i];a[b]=j,a[d]=e,a[c]=f?0<i?Math.round(10000*(sums[j]-sums[Object.keys(sums)[i-1]])/sums[Object.keys(sums)[i-1]])/100:0:sums[j],h.push(a)}return h}function alignData(a,b,c){var d=[],e=[];for(i=0;i<a.length;i++)100<=a[i][b]&&d.push(a[i]);d.sort((c,a)=>c.location>a.location?1:a.location>c.location?-1:0);let f=d[0].location;for(e.push(d[0]),e[0][c]=1,i=1;i<d.length;i++)d[i].location==f?(e.push(d[i]),e[i][c]=e[i-1][c]+1):(e.push(d[i]),e[i][c]=1,f=d[i].location);return e}function getLastDate(a){let b=a[a.length-2].date,c=a.filter(function(a){return a.date==b});return c}function daysToMs(a){return 1e3*(3600*(24*a))}var regioes={Sudeste:["S\xE3o Paulo","Rio de Janeiro","Minas Gerais","Esp\xEDrito Santo"],"Centro-Oeste":["Distrito Federal","Goi\xE1s","Mato Grosso","Mato Grosso do Sul"],Nordeste:["Maranh\xE3o","Piau\xED","Cear\xE1","Rio Grande do Norte","Para\xEDba","Pernambuco","Alagoas","Sergipe","Bahia"],Sul:["Paran\xE1","Santa Catarina","Rio Grande do Sul"],Norte:["Acre","Amazonas","Par\xE1","Rond\xF4nia","Roraima","Amap\xE1","Tocantins"]},acronyms={Acre:"AC",Alagoas:"AL",Amazonas:"AM",Bahia:"BA",Ceará:"CE","Distrito Federal":"DF","Espírito Santo":"ES",Goiás:"GO",Amapá:"AP",Maranhão:"MA","Mato Grosso":"MT","Mato Grosso do Sul":"MS","Minas Gerais":"MG",Paraná:"PR",Paraíba:"PB",Pará:"PA",Pernambuco:"PE",Piauí:"PI","Rio Grande do Norte":"RN","Rio Grande do Sul":"RS","Rio de Janeiro":"RJ",Rondônia:"RO",Roraima:"RR","Santa Catarina":"SC",Sergipe:"SE","São Paulo":"SP",Tocantins:"TO"},nomesEstados=Object.keys(acronyms).sort();regioes.Brasil=nomesEstados;var myColors=["#2b547e"].concat(palette("mpn65",26).map(a=>"#"+a)),highchartsOptions=Highcharts.setOptions({lang:{loading:"Aguarde...",months:["Janeiro","Fevereiro","Mar\xE7o","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],weekdays:["Domingo","Segunda","Ter\xE7a","Quarta","Quinta","Sexta","S\xE1bado"],shortMonths:["Jan","Feb","Mar","Abr","Maio","Jun","Jul","Ago","Set","Out","Nov","Dez"],viewFullscreen:"Ver em tela cheia",exitFullscreen:"Sair da tela cheia",printChart:"Imprimir",rangeSelectorFrom:"De",rangeSelectorTo:"At\xE9",rangeSelectorZoom:"Periodo",downloadPNG:"Download imagem PNG",downloadJPEG:"Download imagem JPEG",downloadPDF:"Download documento PDF",downloadSVG:"Download imagem SVG",numericSymbols:null,thousandsSep:",",resetZoom:"Resetar zoom"},chart:{borderWidth:1,borderColor:"#666666",borderRadius:10,spacingBottom:16,backgroundColor:"#FEFEFE",zoomType:"x",resetZoomButton:{position:{x:-150,y:10},relativeTo:"chart",theme:{height:14}},panning:!0,panKey:"ctrl"},subtitle:{text:"Fonte: Minist\xE9rio da Sa\xFAde",align:"left",verticalAlign:"bottom",floating:!0,style:{"margin-top":"-30px"},y:28},colors:myColors});function createLineChart(a){Highcharts.chart({chart:{renderTo:a,type:"line",styledMode:!1},data:{dateFormat:"YYYY-mm-dd"},xAxis:{type:"datetime",dateTimeLabelFormats:{day:"%d/%m"},tickInterval:daysToMs(1),labels:{rotation:-45}},yAxis:{min:1,labels:{format:"{value:,.0f}"}},legend:{enabled:!1},plotOptions:{line:{marker:{enabled:!0,radius:3}}},tooltip:{crosshairs:!0,shared:!0,dateTimeLabelFormats:{day:"%A, %d/%m/%Y"},outside:!0,formatter:function(a){var b=this.points||splat(this),c=b[0].series;return b.sort(function(c,a){return c.y<a.y?1:c.y>a.y?-1:0}),a.defaultFormatter.call(this,a)}},title:{align:"left"},defs:{custombtn:{tagName:"pattern",id:"custom-btn-bg",width:100}},exporting:{buttons:{customButton:{text:"Logar\xEDtmica",id:"btn",onclick:function(){this.yAxis[0].isLog?(this.yAxis[0].update({type:"linear"}),this.exportSVGElements[2].attr({text:"Logar\xEDtmica"})):(this.yAxis[0].update({type:"logarithmic"}),this.exportSVGElements[2].attr({text:"Linear"}))},theme:{width:70,"text-align":"center"}}}}})}function createColumnChart(a,b=null){Highcharts.chart(a,{chart:{type:"column"},plotOptions:{series:{groupPadding:0,colorByPoint:!1}},tooltip:{shared:!0,formatter:function(){var a,c=this.point,d=this.series;return a=this.points[0].point.pct,name=this.points[0].point.name,"<small>"+name+"</small>:<br><b>"+this.y+"</b> ("+a+"% dos "+b+")"}},legend:{align:"center",floating:!1,verticalAlign:"bottom",layout:"horizontal",enabled:!1,labelFormatter:function(){return acronyms[this.name]}}})}const msGetURL="https://xx9p7hp1p7.execute-api.us-east-1.amazonaws.com/prod/PortalGeral";let brasilDataSource,rawBrasilData,brasilData;function parseBrasilData(a){if(a){for(parsedData=Papa.parse(rawBrasilData,{header:!0,dynamicTyping:!0}).data,i=0;i<parsedData.length-1;i++)parsedData[i].date=parsedData[i].date.split("/").reverse().join("-"),parsedData[i].location=Object.keys(acronyms).find(a=>acronyms[a]===parsedData[i].location);parsedData[parsedData.length-2].date>=estados[estados.length-1].date?(console.log("Succesfully fetched MS data."),estados=parsedData):console.log("Succesfully fetched MS data but file is outdated, using manual data instead.")}generatePlotsBrasil()}let rawWorldData,worldData;const worldDataSource="https://covid.ourworldindata.org/data/ecdc/full_data.csv",worldCompare=["Italy","United States","Spain","Germany","United Kingdom","South Korea"],worldTrad={"United States":"EUA",Italy:"It\xE1lia",Spain:"Espanha",Germany:"Alemanha","United Kingdom":"Reino Unido","South Korea":"Coreia do Sul"};function parseWorldData(){worldData=Papa.parse(rawWorldData,{header:!0,dynamicTyping:!0}).data;let a=formatToChart(alignData(worldData,"total_cases","day"),"total_cases","day");createLineChart("world_comp");var b=$("#world_comp").highcharts();for(b.addSeries({name:"Brasil",data:formatToChart(alignData(summarise(estados,"date","total_cases","location","Brasil"),"total_cases","day"),"total_cases","day")[0].data},!1),i=0;i<worldCompare.length;i++){let c=a.filter(function(a){return a.name==worldCompare[i]})[0];b.addSeries({name:worldTrad[c.name],data:c.data},!1)}b.update({yAxis:{title:{text:"Casos Confirmados"},min:100,type:"logarithmic"},xAxis:{type:"linear",tickInterval:1,labels:{rotation:0},title:{text:"Dia"}},title:{text:"Casos confirmados ap\xF3s o 100\xBA caso"},subtitle:{text:"Fontes: Minist\xE9rio da Sa\xFAde e Our World in Data"},legend:{enabled:!0},tooltip:{headerFormat:"<small>Dia {point.key}</small><br>"},exporting:{buttons:{customButton:{text:"Linear"}}}});let c=formatToChart(alignData(worldData,"total_deaths","day"),"total_deaths","day");createLineChart("world_comp_obitos");var d=$("#world_comp_obitos").highcharts();for(d.addSeries({name:"Brasil",data:formatToChart(alignData(summarise(estados,"date","total_deaths","location","Brasil"),"total_deaths","day"),"total_deaths","day")[0].data},!1),i=0;i<worldCompare.length;i++){let a=c.filter(function(a){return a.name==worldCompare[i]})[0];d.addSeries({name:worldTrad[a.name],data:a.data},!1)}d.update({yAxis:{title:{text:"\xD3bitos"},min:100,type:"logarithmic"},xAxis:{type:"linear",tickInterval:1,labels:{rotation:0},title:{text:"Dia"}},title:{text:"\xD3bitos ap\xF3s o 100\xBA \xF3bito"},subtitle:{text:"Fontes: Minist\xE9rio da Sa\xFAde e Our World in Data"},legend:{enabled:!0},tooltip:{headerFormat:"<small>Dia {point.key}</small><br>"},exporting:{buttons:{customButton:{text:"Linear"}}}})}function generatePlotsBrasil(){createLineChart("br_casos"),$("#br_casos").highcharts().addSeries({name:"Brasil",data:formatToChart(summarise(estados,"date","total_cases","location","Brasil"),"total_cases")[0].data},!1),$("#br_casos").highcharts().update({yAxis:{title:{text:"Casos Confirmados"}},title:{text:"Casos confirmados"}}),createLineChart("br_obitos"),$("#br_obitos").highcharts().addSeries({name:"Brasil",data:formatToChart(summarise(estados,"date","total_deaths","location","Brasil"),"total_deaths")[0].data},!1),$("#br_obitos").highcharts().update({yAxis:{title:{text:"\xD3bitos"}},title:{text:"\xD3bitos"}}),createLineChart("br_novoscasos"),$("#br_novoscasos").highcharts().addSeries({name:"Novos",yAxis:0,data:formatToChart(summarise(estados,"date","new_cases","location","Novos"),"new_cases")[0].data},!1),$("#br_novoscasos").highcharts().update({yAxis:{title:{text:"Novos casos",style:{color:myColors[0]}},labels:{style:{color:myColors[0]}}},title:{text:"Novos casos"}},!1),$("#br_novoscasos").highcharts().addAxis({title:{text:"Varia\xE7\xE3o em rela\xE7\xE3o ao dia anterior",style:{color:myColors[1]}},min:0,max:100,opposite:!0,labels:{format:"{value}%",style:{color:myColors[1]}}},!1),$("#br_novoscasos").highcharts().addSeries({name:"Aumento",yAxis:1,data:formatToChart(summarise(estados,"date","total_cases","location","Aumento",!0),"total_cases")[0].data,tooltip:{valueSuffix:"%"}},!0),createLineChart("br_novosobitos"),$("#br_novosobitos").highcharts().addSeries({name:"Brasil",data:formatToChart(summarise(estados,"date","new_deaths","location","Brasil"),"new_deaths")[0].data},!1),$("#br_novosobitos").highcharts().update({yAxis:{title:{text:"Novos \xF3bitos",style:{color:myColors[0]}},labels:{style:{color:myColors[0]}}},title:{text:"Novos \xF3bitos"}},!1),$("#br_novosobitos").highcharts().addAxis({title:{text:"Varia\xE7\xE3o em rela\xE7\xE3o ao dia anterior",style:{color:myColors[1]}},min:0,max:100,opposite:!0,labels:{format:"{value}%",style:{color:myColors[1]}}},!1),$("#br_novosobitos").highcharts().addSeries({name:"Aumento",yAxis:1,data:formatToChart(summarise(estados,"date","total_deaths","location","Aumento",!0),"total_deaths")[0].data,tooltip:{valueSuffix:"%"}},!0);let a=formatToColumnChart(getLastDate(estados,"total_cases"),"location","total_cases"),b=jQuery.extend(!0,{},a);for(i=0;i<b.series[0].data.length;i++){var c=b.series[0].data[i];c.y=Math.round(10000000*c.y/populacao[0][c.name])/100}b.series[0].data.sort((c,a)=>parseFloat(a.y)-parseFloat(c.y)),b.order=[...new Set(b.series[0].data.map(a=>a.name))],createColumnChart("estados_dist","casos"),$("#estados_dist").highcharts().addSeries({data:formatToColumnChart(getLastDate(estados,"total_cases"),"location","total_cases").series[0].data},!1),$("#estados_dist").highcharts().update({title:{text:"Distribui\xE7\xE3o de casos por estado"},xAxis:{crosshair:!0,categories:a.order},yAxis:{title:{text:"Casos Confirmados"}},exporting:{buttons:{customButton:{text:"Por Habitantes",onclick:function(){"Por Habitantes"==this.exportSVGElements[2].text.textStr?(this.series[0].update({data:b.series[0].data},!1),this.xAxis[0].setCategories(b.order,!1),this.yAxis[0].setTitle({text:"Casos por 100 mil habitantes"}),this.exportSVGElements[2].attr({text:"Total"})):(this.series[0].update({data:a.series[0].data},!1),this.xAxis[0].setCategories(a.order,!1),this.yAxis[0].setTitle({text:"Casos Confirmados"}),this.exportSVGElements[2].attr({text:"Por Habitantes"}))},theme:{width:80,"text-align":"center"}}}}});let d=formatToColumnChart(getLastDate(estados,"total_deaths"),"location","total_deaths"),e=jQuery.extend(!0,{},d);for(i=0;i<e.series[0].data.length;i++){var c=e.series[0].data[i];c.y=Math.round(10000000*c.y/populacao[0][c.name])/100}e.series[0].data.sort((c,a)=>parseFloat(a.y)-parseFloat(c.y)),e.order=[...new Set(e.series[0].data.map(a=>a.name))],createColumnChart("estados_dist_obitos","\xF3bitos"),$("#estados_dist_obitos").highcharts().addSeries({data:formatToColumnChart(getLastDate(estados,"total_deaths"),"location","total_deaths").series[0].data},!1),$("#estados_dist_obitos").highcharts().update({title:{text:"Distribui\xE7\xE3o de \xF3bitos por estado"},xAxis:{crosshair:!0,categories:d.order},yAxis:{title:{text:"\xD3bitos"}},exporting:{buttons:{customButton:{text:"Por Habitantes",onclick:function(){"Por Habitantes"==this.exportSVGElements[2].text.textStr?(this.series[0].update({data:e.series[0].data},!1),this.xAxis[0].setCategories(e.order,!1),this.yAxis[0].setTitle({text:"\xD3bitos por 100 mil habitantes"}),this.exportSVGElements[2].attr({text:"Total"})):(this.series[0].update({data:d.series[0].data},!1),this.xAxis[0].setCategories(d.order,!1),this.yAxis[0].setTitle({text:"\xD3bitos"}),this.exportSVGElements[2].attr({text:"Por Habitantes"}))},theme:{width:80,"text-align":"center"}}}}}),$("#sel_estado").change(function(){let a=$("#estado_casos").highcharts();a.series[0].update({name:$("#sel_estado").val(),data:formatToChart(estados.filter(function(a){return a.location==$("#sel_estado").val()}),"total_cases")[0].data},!1),a.setTitle({text:"Casos confirmados - "+$("#sel_estado").val()});let b=$("#estado_obitos").highcharts();b.series[0].update({name:$("#sel_estado").val(),data:formatToChart(estados.filter(function(a){return a.location==$("#sel_estado").val()}),"total_deaths")[0].data},!1),b.setTitle({text:"\xD3bitos - "+$("#sel_estado").val()});let c=$("#estado_novoscasos").highcharts();c.series[0].update({name:$("#sel_estado").val(),data:formatToChart(estados.filter(function(a){return a.location==$("#sel_estado").val()}),"new_cases")[0].data},!1),c.setTitle({text:"Casos confirmados - "+$("#sel_estado").val()});let d=$("#estado_novosobitos").highcharts();d.series[0].update({name:$("#sel_estado").val(),data:formatToChart(estados.filter(function(a){return a.location==$("#sel_estado").val()}),"new_deaths")[0].data},!1),d.setTitle({text:"Novos \xF3bitos - "+$("#sel_estado").val()}),a.redraw(),b.redraw(),c.redraw(),d.redraw()}),createLineChart("estado_casos"),$("#estado_casos").highcharts().addSeries({name:$("#sel_estado").val(),data:formatToChart(estados.filter(function(a){return a.location==$("#sel_estado").val()}),"total_cases")[0].data},!1),$("#estado_casos").highcharts().update({yAxis:{title:{text:"Casos confirmados"}},title:{text:"Casos confirmados - "+$("#sel_estado").val()}}),createLineChart("estado_obitos"),$("#estado_obitos").highcharts().addSeries({name:$("#sel_estado").val(),data:formatToChart(estados.filter(function(a){return a.location==$("#sel_estado").val()}),"total_deaths")[0].data},!1),$("#estado_obitos").highcharts().update({yAxis:{title:{text:"\xD3bitos"}},title:{text:"\xD3bitos - "+$("#sel_estado").val()}}),createLineChart("estado_novoscasos"),$("#estado_novoscasos").highcharts().addSeries({name:$("#sel_estado").val(),data:formatToChart(estados.filter(function(a){return a.location==$("#sel_estado").val()}),"new_cases")[0].data},!1),$("#estado_novoscasos").highcharts().update({yAxis:{title:{text:"Novos casos"}},title:{text:"Novos casos - "+$("#sel_estado").val()}},!0),createLineChart("estado_novosobitos"),$("#estado_novosobitos").highcharts().addSeries({name:$("#sel_estado").val(),data:formatToChart(estados.filter(function(a){return a.location==$("#sel_estado").val()}),"new_deaths")[0].data},!1),$("#estado_novosobitos").highcharts().update({yAxis:{title:{text:"\xD3bitos"}},title:{text:"Novos \xF3bitos - "+$("#sel_estado").val()}},!0),createLineChart("estados_casos");let f=formatToChart(estados,"total_cases"),g=$("#estados_casos").highcharts();for(;0<g.series.length;)g.series[0].remove(!1);for(i=0;i<f.length;i++)g.addSeries({name:f[i].name,data:f[i].data},!1);g.update({yAxis:{title:{text:"Casos Confirmados"}},title:{text:"Casos - todos estados"},legend:{align:"center",floating:!1,verticalAlign:"bottom",layout:"horizontal",enabled:!0,labelFormatter:function(){return acronyms[this.name]}}}),createLineChart("estados_obitos");let h=formatToChart(estados,"total_deaths"),j=$("#estados_obitos").highcharts();for(;0<j.series.length;)j.series[0].remove(!1);for(i=0;i<h.length;i++)j.addSeries({name:h[i].name,data:h[i].data},!1);j.update({yAxis:{title:{text:"\xD3bitos"}},title:{text:"\xD3bitos - todos estados"},legend:{align:"center",floating:!1,verticalAlign:"bottom",layout:"horizontal",enabled:!0,labelFormatter:function(){return acronyms[this.name]}}}),createLineChart("regiao_casos"),createLineChart("regiao_obitos"),$("#sel_regiao").change(function(){let a=formatToChart(estados.filter(function(a){return regioes[$("#sel_regiao").val()].includes(a.location)}),"total_cases"),b=$("#regiao_casos").highcharts();for(;0<b.series.length;)b.series[0].remove(!1);for(i=0;i<a.length;i++)b.addSeries({name:a[i].name,data:a[i].data},!1);b.update({yAxis:{title:{text:"Casos Confirmados"}},title:{text:"Casos - "+$("#sel_regiao").val()},legend:{align:"center",floating:!1,verticalAlign:"bottom",layout:"horizontal",enabled:!0,labelFormatter:function(){return acronyms[this.name]}}});let c=formatToChart(estados.filter(function(a){return regioes[$("#sel_regiao").val()].includes(a.location)}),"total_deaths"),d=$("#regiao_obitos").highcharts();for(;0<d.series.length;)d.series[0].remove(!1);for(i=0;i<c.length;i++)d.addSeries({name:c[i].name,data:c[i].data},!1);d.update({yAxis:{title:{text:"\xD3bitos"}},title:{text:"\xD3bitos - "+$("#sel_regiao").val()},legend:{align:"center",floating:!1,verticalAlign:"bottom",layout:"horizontal",enabled:!0,labelFormatter:function(){return acronyms[this.name]}}})}),$("#sel_regiao").change();let k=formatToChart(alignData(estados,"total_cases","day"),"total_cases","day");for(createLineChart("estados_comp"),i=0;i<k.length;i++)$("#estados_comp").highcharts().addSeries({name:k[i].name,data:k[i].data},!1);$("#estados_comp").highcharts().update({yAxis:{type:"logarithmic",min:100,title:{text:"Casos Confirmados"}},xAxis:{type:"linear",tickInterval:1,labels:{rotation:0},title:{text:"Dia"}},title:{text:"Casos Confirmados ap\xF3s o 100\xBA caso"},legend:{align:"center",floating:!1,verticalAlign:"bottom",layout:"horizontal",enabled:!0,labelFormatter:function(){return acronyms[this.name]}},tooltip:{headerFormat:"<small>Dia {point.key}</small><br>"},exporting:{buttons:{customButton:{text:"Linear"}}}}),$("#loading, #wall").hide()}document.addEventListener("DOMContentLoaded",function(){nomesEstados.forEach(function(a){$("#sel_estado").append(new Option(a,a))}),$("#sel_estado").val("Distrito Federal"),["Sudeste","Centro-Oeste","Nordeste","Sul","Norte"].forEach(function(a){$("#sel_regiao").append(new Option(a,a))}),fetch(worldDataSource).then(function(a){a.text().then(function(a){rawWorldData=a,parseWorldData()})}),$.ajaxSetup({headers:{"x-parse-application-id":"unAFkcaNDeXajurGB7LChj8SgQYS2ptm"},error:function(){console.log("Erro (GET request failed): falha ao carregar dados do Minist\xE9rio da Sa\xFAde, utilizando dados em cache."),parseBrasilData(!1)}}),$.get(msGetURL,function(a){brasilDataSource=a.results[0].arquivo.url,"file:"==window.location.protocol?(console.log("Running locally and ignoring MS data."),parseBrasilData(!1)):fetch(brasilDataSource).then(function(a){a.text().then(function(a){rawBrasilData=a.replace("data","date").replace("estado","location").replace("casosNovos","new_cases").replace("casosAcumulados","total_cases").replace("obitosNovos","new_deaths").replace("obitosAcumulados","total_deaths"),parseBrasilData(!0)})}).catch(function(){console.log("Erro (file request failed): Falha ao carregar dados do Minist\xE9rio da Sa\xFAde, utilizando dados em cache."),parseBrasilData(!1)})},"json")});
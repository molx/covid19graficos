function dateToDM(t){var e=t.getUTCDate(),a=t.getUTCMonth()+1;return(e<=9?"0"+e:e)+"/"+(a<=9?"0"+a:a)}function numberWithSep(t){return t>999?t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."):t.toString().replace(".",",")}function isArray(t){return"[object Array]"===Object.prototype.toString.call(t)}function splat(t){return isArray(t)?t:[t]}function matchStart(t,e){return t.term=t.term||"",0==e.text.toUpperCase().indexOf(t.term.toUpperCase())&&e}function formatToChart(t,e,a="date"){const o=[...new Set(t.map(t=>t.location))];let s=[];return o.forEach(function(o){let r,i=t.filter(function(t){return t.location==o}),n=[],l=!0;i.forEach(function(t){!t[e]&&l||(l=!1,r={},r.x="date"==a?Date.parse(t[a]):t[a],r.y="weekly_cases"==e||"weekly_deaths"==e?Math.round(t[e]/7):t[e],Object.keys(t).map(e=>r[e]=t[e]),n.push(r))}),s.push({name:o,data:n})}),s}function formatToColumnChart(t,e,a){let o=[{data:[]}];const s=Object.values(t).reduce((t,e)=>+t+e[a],0);for(i=0;i<t.length;i++)if("CFR"==a)o[0].data.push({name:t[i][e],y:t[i][a],color:myColors[i],deaths:t[i].total_deaths,cases:t[i].total_cases});else{let r=Math.round(1e4*t[i][a]/s)/100;o[0].data.push({name:t[i][e],y:t[i][a],color:myColors[i],pct:r})}o[0].data.sort((t,e)=>parseFloat(e.y)-parseFloat(t.y));let r=[...new Set(o[0].data.map(t=>t.name))];return{series:o,order:r}}function formatDBLInterval(t,e="date"){const a=[...new Set(t.map(t=>t.location))];let o=[];return a.forEach(function(a){let s,r=t.filter(function(t){return t.location==a}),i=[];r.forEach(function(t){s={low:t.dbl_time_lwr,high:t.dbl_time_upr},s.x="date"==e?Date.parse(t.date):t[e],Object.keys(t).map(e=>s[e]=t[e]),i.push(s)}),o.push({name:a,data:i})}),o}function formatChartRace(t,e){let a=[...new Set(t.map(t=>t.date.getTime()))],o=[],s=[...new Set(t.map(t=>t.location))],r={};for(i=0;i<s.length;i++)r[s[i]]=myColors[i];for(i=0;i<a.length;i++){let s=t.filter(t=>t.date.getTime()==a[i]),n=s.map(t=>t[e]),l=s.map(t=>t.location);if(n.reduce((t,e)=>t+e)>0){let t=[];for(j=0;j<n.length;j++)t.push({y:n[j],name:l[j],color:r[l[j]]});o.push({ref:dateToDM(new Date(a[i])),data:t})}}return o}function formatChartRace2(t,e){let a=[...new Set(t.map(t=>t.date.getTime()))],o=[];for(i=0;i<a.length;i++){let s=t.filter(t=>t.date.getTime()==a[i]),r=s.map(t=>t[e]),n=s.map(t=>t.location);if(r.reduce((t,e)=>t+e)>0){let t=[];for(j=0;j<r.length;j++)t.push({name:n[j],data:{y:r[j]}});o.push({ref:dateToDM(new Date(a[i])),series:t})}}return o}function summarise(t,e,a,o,s,r=!1){isArray(a)||(a=[a]);var n=[];for(v=0;v<a.length;v++){n[a[v]]||(n[a[v]]={});for(let o=0;o<t.length;o++)n[a[v]][t[o][e]]?n[a[v]][t[o][e]]+=t[o][a[v]]:n[a[v]][t[o][e]]=t[o][a[v]]}var l={},d=[];for(i=0;i<Object.keys(n[a[0]]).length;i++){let t=Object.assign({},l),m=Object.keys(n[a[0]])[i];for(t[e]=m,t[o]=s,v=0;v<a.length;v++)t[a[v]]=r?i>0?Math.round(1e4*(n[a[v]][m]-n[a[v]][Object.keys(n[a[v]])[i-1]])/n[a[v]][Object.keys(n[a[v]])[i-1]])/100:0:n[a[v]][m];d.push(t)}return d}function getLastDate(t){let e=t[t.length-1].date.getTime(),a=t.filter(function(t){return t.date.getTime()==e});return a}function getCFR(t,e=!0){let a=[];for(Object.assign(a,t),e&&(a=getLastDate(a)),i=0;i<a.length;i++)a[i].CFR=Math.round(1e4*a[i].total_deaths/a[i].total_cases)/100,a[i].CFR=isNaN(a[i].CFR)?0:a[i].CFR;let o=a.filter(function(t){return t.total_deaths>=20});return o}function daysToMs(t){return 24*t*3600*1e3}function changeType(t,e){t.yAxis[0].isLog?(t.yAxis[0].update({type:"linear"},!1,!1,!1),t.exportSVGElements[2].attr({text:"Logarítmica"})):(t.yAxis[0].update({type:"logarithmic"},!1,!1,!1),t.exportSVGElements[2].attr({text:"Linear"})),t.redraw(e)}function createLineChart(t){Highcharts.chart({chart:{renderTo:t,type:"line",styledMode:!1},data:{dateFormat:"YYYY-mm-dd"},xAxis:{type:"datetime",dateTimeLabelFormats:{day:"%d/%m"},tickInterval:daysToMs(5),labels:{rotation:-45}},yAxis:{min:1,labels:{format:"{value:,.0f}"}},legend:{enabled:!1},plotOptions:{line:{marker:{enabled:!0,radius:3}}},tooltip:{crosshairs:!0,shared:!0,dateTimeLabelFormats:{day:"%A, %d/%m/%Y"},outside:!0,formatter:function(t){var e=this.points||splat(this);e[0].series;return e.sort(function(t,e){return t.y<e.y?1:t.y>e.y?-1:0}),t.defaultFormatter.call(this,t)}},exporting:{buttons:{customButton:{text:"Logarítmica",id:"btn",onclick:function(){changeType(this,!0)},theme:{width:70,"text-align":"center",stroke:"#000",r:6}}}}})}function createColumnChart(t,e=null){Highcharts.chart(t,{chart:{type:"column"},plotOptions:{series:{groupPadding:0,colorByPoint:!1}},tooltip:{shared:!0,formatter:function(){var t;this.point,this.series;return t=this.points[0].point.pct,name=this.points[0].point.name,'<span style="font-size: 10px">'+name+"</span>:<br><b>"+this.y+"</b> ("+t+"% dos "+e+")"}},legend:{align:"center",floating:!1,verticalAlign:"bottom",layout:"horizontal",enabled:!1,labelFormatter:function(){return acronyms[this.name]}}})}function createTimeColumnChart(t){Highcharts.chart(t,{chart:{type:"column"},plotOptions:{series:{groupPadding:0,colorByPoint:!1}},data:{dateFormat:"YYYY-mm-dd"},xAxis:{type:"datetime",dateTimeLabelFormats:{day:"%d/%m"},tickInterval:daysToMs(5),labels:{rotation:-45}},tooltip:{crosshairs:!0,shared:!0,dateTimeLabelFormats:{day:"%A, %d/%m/%Y"},outside:!0,valueDecimals:0},legend:{align:"center",floating:!1,verticalAlign:"bottom",layout:"horizontal",enabled:!1,labelFormatter:function(){return acronyms[this.name]}}})}function parseBrasilData(t){if(console.log("Time to download Brasil data: "+((new Date).getTime()-starttimeBR)+"ms"),starttimeBR=(new Date).getTime(),t){parsedData=Papa.parse(rawBrasilData,{header:!0,dynamicTyping:!0,skipEmptyLines:!0}).data,console.log("Time to parse Brasil data: "+((new Date).getTime()-starttimeBR)+"ms"),starttimeBR=(new Date).getTime();let t=Object.values(parsedData[0]),e="string"==typeof t[2],a=Object.keys(parsedData[0]);refCols=["date","location","new_cases","total_cases","new_deaths","total_deaths"];try{if(e)if(refCols.every(t=>a.includes(t))){parsedData.map(t=>t.date=t.date.split("/").reverse().join("-")),parsedData.map(t=>t.location=Object.keys(acronyms).find(e=>acronyms[e]===t.location));let t=new Date(estados[estados.length-1].date).getTime(),e=new Date(parsedData[parsedData.length-1].date).getTime();e>=t?(console.log("Succesfully fetched MS data."),estados=parsedData):console.log("Succesfully fetched MS data but file is outdated or corrupted, using manual data instead.")}else console.log("Succesfully fetched MS data but at least one column is missing or misnamed.");else console.log("Succesfully fetched MS data but date column is invalid, using manual data instead.")}catch{console.log("Succesfully fetched MS data but parsing led to unknown error. Using manual data instead.")}}console.log("Time to check Brasil MS data: "+((new Date).getTime()-starttimeBR)+"ms"),starttimeBR=(new Date).getTime(),brasilData=summarise(estados,"date",["total_cases","total_deaths","new_cases","new_deaths"],"location","Brasil"),console.log("Time to summarise Brasil data: "+((new Date).getTime()-starttimeBR)+"ms"),starttimeBR=(new Date).getTime(),brasilData=addColumns(brasilData),estados=addColumns(estados),loadedBrasilData=!0,console.log("Time to process Brasil data: "+((new Date).getTime()-starttimeBR)+"ms"),loadedWorldData&&(generatePlots(),loadedBrasilData=!1)}function parseWorldData(){console.log("Time to download World data: "+((new Date).getTime()-starttimeW)+"ms"),starttimeW=(new Date).getTime(),worldData=Papa.parse(rawWorldData,{header:!0,dynamicTyping:!0,skipEmptyLines:!0}).data,console.log("Time to parse World data: "+((new Date).getTime()-starttimeW)+"ms"),starttimeW=(new Date).getTime(),worldData.map(t=>t.location=worldTrad[t.location]?worldTrad[t.location]:t.location),worldData=addColumns(worldData,!1),loadedWorldData=!0,console.log("Time to process World data: "+((new Date).getTime()-starttimeW)+"ms"),loadedBrasilData&&(generatePlots(),loadedWorldData=!1)}function addColumns(t,e=!1){let a=864e5,o=[];t.map(t=>t.date=new Date(t.date)),e&&t.map(t=>t.date.setDate(t.date.getDate()-1));let s=[...new Set(t.map(t=>t.location))];for(i=0;i<s.length;i++){let e=1/0,r=1/0,n=t.filter(t=>t.location==s[i]);for(n[0].change_cases=0,n[0].change_deaths=0,j=1;j<n.length;j++)n[j].change_cases=Math.round(1e4*n[j].new_cases/n[j-1].total_cases)/100,n[j].change_deaths=Math.round(1e4*n[j].new_deaths/n[j-1].total_deaths)/100,e==1/0&&n[j].total_cases>=100&&(e=n[j].date),r==1/0&&n[j].total_deaths>=100&&(r=n[j].date),n[j].day_cases=(n[j].date-e)/a+1,n[j].day_deaths=(n[j].date-r)/a+1,n[j].CFR=Math.round(1e4*n[j].total_deaths/n[j].total_cases)/100,n[j].cases_per_pop=Math.round(1e9*n[j].total_cases/populacao[0][s[i]])/100,n[j].deaths_per_pop=Math.round(1e9*n[j].total_deaths/populacao[0][s[i]])/100;o=o.concat(n)}return o}function pad(t){return t<10?"0"+t:t}function generatePlots(){function t(t,e){var a,o=t.points||splat(t);return o.sort(function(t,e){return t.y<e.y?1:t.y>e.y?-1:0}),a=e?'<span style="font-size: 10px">Dia '+t.x+"</span>":'<span style="font-size: 10px">'+Highcharts.dateFormat("%A, %d/%m/%Y",t.x)+"</span>",$.each(o,function(){"IC"!=this.series.name&&(a+='<br><span style="color:'+this.series.color+'">●</span> '+this.series.name+": <b>"+numberWithSep(this.y)+"</b>",a+=" (IC: "+numberWithSep(this.point.dbl_time_lwr)+" - "+numberWithSep(this.point.dbl_time_upr)+") dias")}),a}function e(e,a=!1){for(;$("#world_DBL").highcharts().series.length>0;)$("#world_DBL").highcharts().series[0].remove(!1);let o;for(o=a?Y:H,i=0;i<e.length;i++){let t=o.find(function(t){return t.name==e[i]});if($("#world_DBL").highcharts().addSeries({name:t.name,data:t.data},!1),V){let t;t=a?Q:J;let o=t.find(function(t){return t.name==e[i]});$("#world_DBL").highcharts().addSeries({name:"IC",data:o.data,type:"arearange",lineWidth:0,fillOpacity:.2,zIndex:0,linkedTo:":previous",marker:{enabled:!1},color:myColors[i]},!1)}}a?$("#world_DBL").highcharts().update({xAxis:{type:"linear",tickInterval:5,labels:{rotation:0},title:{text:"Dia"}}},!1):$("#world_DBL").highcharts().update({xAxis:{type:"datetime",dateTimeLabelFormats:{day:"%d/%m"},tickInterval:daysToMs(5),labels:{rotation:-45}}},!1),$("#world_DBL").highcharts().update({tooltip:{shared:!0,formatter:function(){return t(this,a)}}},!1),$("#world_DBL").highcharts().redraw()}starttimeHS=(new Date).getTime();var a=brasilData[brasilData.length-1].total_cases,o=brasilData[brasilData.length-1].total_deaths,s=Math.round(1e4*o/a)/100,r=brasilData[brasilData.length-1].date,n=pad(r.getUTCDate())+"/"+pad(r.getUTCMonth()+1)+"/"+r.getUTCFullYear();$("#data_br_dia").html(n),$("#data_br_casos").html(numberWithSep(a)),$("#data_br_obitos").html(numberWithSep(o)),$("#data_br_CFR").html(s.toString().replace(".",",")+"%"),createLineChart("br_casos"),$("#br_casos").highcharts().addSeries({name:"Total de casos",data:formatToChart(brasilData,"total_cases")[0].data},!1),$("#br_casos").highcharts().update({yAxis:{title:{text:"Casos confirmados"}},title:{text:"Casos confirmados"}}),createLineChart("br_obitos"),$("#br_obitos").highcharts().addSeries({name:"Total de óbitos",data:formatToChart(brasilData,"total_deaths")[0].data},!1),$("#br_obitos").highcharts().update({yAxis:{title:{text:"Óbitos"}},title:{text:"Óbitos"}}),createTimeColumnChart("br_novoscasos"),$("#br_novoscasos").highcharts().addSeries({name:"Novos casos",yAxis:0,data:formatToChart(brasilData,"new_cases")[0].data},!1),$("#br_novoscasos").highcharts().addSeries({name:"Média móvel (7 dias)",type:"sma",linkedTo:":previous",params:{period:7},color:myColors[5],step:!0,marker:{enabled:!1},showInLegend:!0},!1),$("#br_novoscasos").highcharts().update({yAxis:{title:{text:"Novos casos",style:{color:myColors[0]}},labels:{style:{color:myColors[0]}},min:0},title:{text:"Novos casos"},legend:{enabled:!0,labelFormatter:function(){return this.name}},exporting:{buttons:{customButton:{enabled:!1}}}},!1),$("#br_novoscasos").highcharts().addAxis({title:{text:"Variação em relação ao dia anterior",style:{color:myColors[1]}},min:0,max:50,opposite:!0,labels:{format:"{value}%",style:{color:myColors[1]}}},!1),$("#br_novoscasos").highcharts().addSeries({name:"Aumento",yAxis:1,type:"line",marker:{enabled:!1},color:myColors[1],data:formatToChart(brasilData,"change_cases")[0].data,tooltip:{valueSuffix:"%"}},!0),createTimeColumnChart("br_novosobitos"),$("#br_novosobitos").highcharts().addSeries({name:"Novos óbitos",data:formatToChart(brasilData,"new_deaths")[0].data},!1),$("#br_novosobitos").highcharts().addSeries({name:"Média móvel (7 dias)",type:"sma",linkedTo:":previous",params:{period:7},color:myColors[5],step:!0,marker:{enabled:!1},showInLegend:!0},!1),$("#br_novosobitos").highcharts().update({yAxis:{title:{text:"Novos óbitos",style:{color:myColors[0]}},labels:{style:{color:myColors[0]}},min:0},title:{text:"Novos óbitos"},legend:{enabled:!0,labelFormatter:function(){return this.name}},exporting:{buttons:{customButton:{enabled:!1}}}},!1),$("#br_novosobitos").highcharts().addAxis({title:{text:"Variação em relação ao dia anterior",style:{color:myColors[1]}},min:0,max:50,opposite:!0,labels:{format:"{value}%",style:{color:myColors[1]}}},!1),$("#br_novosobitos").highcharts().addSeries({name:"Aumento",marker:{enabled:!1},yAxis:1,type:"line",data:formatToChart(brasilData,"change_deaths")[0].data,tooltip:{valueSuffix:"%"}},!0);let l=formatToChart(brasilData,"CFR","date");createLineChart("br_CFR"),$("#br_CFR").highcharts().addSeries({name:"Taxa de letalidade",data:l[0].data},!1),$("#br_CFR").highcharts().update({chart:{marginTop:50},yAxis:{title:{text:"Variação da letalidade"},labels:{format:"{value}%"}},title:{text:"Letalidade"},subtitle:{text:"A partir do 20º óbito"},tooltip:{shared:!1,valueSuffix:"%"},exporting:{buttons:{customButton:{enabled:!1}}}});let d=formatToChart(dbl_time_br.filter(t=>"Brasil"==t.location),"dbl_time","date"),m=formatDBLInterval(dbl_time_br.filter(t=>"Brasil"==t.location),"date");createLineChart("br_DBL"),$("#br_DBL").highcharts().addSeries({name:"Tempo de duplicação",data:d[0].data},!1),$("#br_DBL").highcharts().addSeries({name:"Intervalo de Confiança",data:m[0].data,type:"arearange",lineWidth:0,fillOpacity:.2,zIndex:0,linkedTo:":previous",marker:{enabled:!1},color:myColors[0]},!1),$("#br_DBL").highcharts().update({chart:{marginTop:65},yAxis:{title:{text:"Tempo de duplicação (dias)"},min:2,tickInterval:5},title:{text:"Tempo de duplicação*"},subtitle:{text:"Calculado com base nos óbitos dos últimos 7 dias. Os ICs se referem a um nível de confiança de 95%."},tooltip:{shared:!0,valueSuffix:" dias"},exporting:{buttons:{customButton:{enabled:!1}}}});let c=formatToColumnChart(getLastDate(estados),"location","total_cases"),h=jQuery.extend(!0,{},c);for(i=0;i<h.series[0].data.length;i++){var p=h.series[0].data[i];p.y=Math.round(1e9*p.y/populacao[0][p.name])/100}h.series[0].data.sort((t,e)=>parseFloat(e.y)-parseFloat(t.y)),h.order=[...new Set(h.series[0].data.map(t=>t.name))],createColumnChart("estados_dist","casos"),$("#estados_dist").highcharts().addSeries({data:formatToColumnChart(getLastDate(estados),"location","total_cases").series[0].data},!1),$("#estados_dist").highcharts().update({title:{text:"Distribuição de casos por estado"},xAxis:{crosshair:!0,categories:c.order.map(t=>acronyms[t]),labels:{style:{fontSize:"9px"}}},yAxis:{title:{text:"Casos confirmados"}},exporting:{buttons:{customButton:{text:"Por Habitantes",onclick:function(){"Por Habitantes"==this.exportSVGElements[2].text.textStr?(this.series[0].update({data:h.series[0].data},!1),this.xAxis[0].setCategories(h.order.map(t=>acronyms[t]),!1),this.yAxis[0].setTitle({text:"Casos por milhão de habitantes"}),this.exportSVGElements[2].attr({text:"Total"})):(this.series[0].update({data:c.series[0].data},!1),this.xAxis[0].setCategories(c.order.map(t=>acronyms[t]),!1),this.yAxis[0].setTitle({text:"Casos confirmados"}),this.exportSVGElements[2].attr({text:"Por Habitantes"}))},theme:{stroke:"#000",r:6,width:80,"text-align":"center"}}}}});let u=formatToColumnChart(getLastDate(estados),"location","total_deaths"),b=jQuery.extend(!0,{},u);for(i=0;i<b.series[0].data.length;i++){p=b.series[0].data[i];p.y=Math.round(1e9*p.y/populacao[0][p.name])/100}b.series[0].data.sort((t,e)=>parseFloat(e.y)-parseFloat(t.y)),b.order=[...new Set(b.series[0].data.map(t=>t.name))],createColumnChart("estados_dist_obitos","óbitos"),$("#estados_dist_obitos").highcharts().addSeries({data:formatToColumnChart(getLastDate(estados),"location","total_deaths").series[0].data},!1),$("#estados_dist_obitos").highcharts().update({title:{text:"Distribuição de óbitos por estado"},xAxis:{crosshair:!0,categories:u.order.map(t=>acronyms[t]),labels:{style:{fontSize:"9px"}}},yAxis:{title:{text:"Óbitos"}},exporting:{buttons:{customButton:{text:"Por Habitantes",onclick:function(){"Por Habitantes"==this.exportSVGElements[2].text.textStr?(this.series[0].update({data:b.series[0].data},!1),this.xAxis[0].setCategories(b.order.map(t=>acronyms[t]),!1),this.yAxis[0].setTitle({text:"Óbitos por milhão de habitantes"}),this.exportSVGElements[2].attr({text:"Total"})):(this.series[0].update({data:u.series[0].data},!1),this.xAxis[0].setCategories(u.order.map(t=>acronyms[t]),!1),this.yAxis[0].setTitle({text:"Óbitos"}),this.exportSVGElements[2].attr({text:"Por Habitantes"}))},theme:{stroke:"#000",r:6,width:80,"text-align":"center"}}}}});let g=formatToColumnChart(getLastDate(estados).filter(function(t){return t.total_deaths>=20}),"location","CFR");createColumnChart("estados_CFR"),$("#estados_CFR").highcharts().addSeries({data:g.series[0].data},!1),$("#estados_CFR").highcharts().update({chart:{marginTop:70},title:{text:"Letalidade por estado"},xAxis:{crosshair:!0,categories:g.order.map(t=>acronyms[t])},yAxis:{title:{text:"Letalidade"},labels:{format:"{value}%"}},tooltip:{formatter:function(){var t=this.points[0].point.name,e=this.points[0].point.deaths,a=this.points[0].point.cases;return'<span style="font-size: 10px">'+t+":</span><br><b>"+numberWithSep(this.y)+"%</b> ("+numberWithSep(e)+" óbitos / "+numberWithSep(a)+" casos)"}},subtitle:{text:"Como o valor da letalidade varia muito quando há poucos casos, só são representados neste gráfico estados em que ocorreram ao menos 20 óbitos",align:"left",y:30,margin:0}});var f=estados.filter(function(t){return t.location==$("#sel_estado").val()}),_=f[f.length-1].total_cases,x=f[f.length-1].total_deaths,y=Math.round(1e4*x/_)/100;$("#data_estado_casos").html(numberWithSep(_)),$("#data_estado_obitos").html(numberWithSep(x)),$("#data_estado_CFR").html(y.toString().replace(".",",")+"%"),$("#sel_estado").change(function(){f=estados.filter(function(t){return t.location==$("#sel_estado").val()}),_=f[f.length-1].total_cases,x=f[f.length-1].total_deaths,y=Math.round(1e4*x/_)/100,$("#data_estado_casos").html(numberWithSep(_)),$("#data_estado_obitos").html(numberWithSep(x)),$("#data_estado_CFR").html(y.toString().replace(".",",")+"%");let t=$("#estado_casos").highcharts();t.series[0].update({name:$("#sel_estado").val(),data:formatToChart(f,"total_cases")[0].data},!1),t.setTitle({text:"Casos confirmados - "+$("#sel_estado").val()},null,!1);let e=$("#estado_obitos").highcharts();e.series[0].update({name:$("#sel_estado").val(),data:formatToChart(f,"total_deaths")[0].data},!1),e.setTitle({text:"Óbitos - "+$("#sel_estado").val()},null,!1);let a=$("#estado_novoscasos").highcharts();a.series[0].update({name:$("#sel_estado").val(),data:formatToChart(f,"new_cases")[0].data},!1),a.setTitle({text:"Novos casos - "+$("#sel_estado").val()},null,!1);let o=$("#estado_novosobitos").highcharts();o.series[0].update({name:$("#sel_estado").val(),data:formatToChart(f,"new_deaths")[0].data},!1),o.setTitle({text:"Novos óbitos - "+$("#sel_estado").val()},null,!1);let s=$("#estado_DBL").highcharts(),r=formatToChart(dbl_time_br.filter(t=>t.location==$("#sel_estado").val()),"dbl_time","date")[0],i=formatDBLInterval(dbl_time_br.filter(t=>t.location==$("#sel_estado").val()),"date")[0],n="Calculado com base nos óbitos dos últimos 7 dias. Os ICs se referem a um nível de confiança de 95%.";r||(r={},i={},r.data=[0],i.data=[0],n="Não há dados suficientes para o cálculo do tempo de duplicação."),s.series[0].update({name:"Tempo de duplicação",data:r.data},!1),s.series[1].update({name:"Intervalo de Confiança",data:i.data},!1),s.update({subtitle:{text:n}},!1);let l,d=$("#estado_mortalidade").highcharts();d.series[0].update({name:$("#sel_estado").val(),data:formatToChart(f,"deaths_per_pop")[0].data},!1),l=$("#sel_estado").val().length>=15?"Evolução da mortalidade - <br>"+$("#sel_estado").val():"Evolução da mortalidade - "+$("#sel_estado").val(),d.setTitle({text:l},null,!1),t.redraw(),e.redraw(),a.redraw(),o.redraw(),s.redraw(),d.redraw()}),createLineChart("estado_casos"),$("#estado_casos").highcharts().addSeries({name:$("#sel_estado").val(),data:formatToChart(f,"total_cases")[0].data},!1),$("#estado_casos").highcharts().update({yAxis:{title:{text:"Casos confirmados"}},title:{text:"Casos confirmados - "+$("#sel_estado").val()}}),createLineChart("estado_obitos"),$("#estado_obitos").highcharts().addSeries({name:$("#sel_estado").val(),data:formatToChart(f,"total_deaths")[0].data},!1),$("#estado_obitos").highcharts().update({yAxis:{title:{text:"Óbitos"}},title:{text:"Óbitos - "+$("#sel_estado").val()}}),createTimeColumnChart("estado_novoscasos"),$("#estado_novoscasos").highcharts().addSeries({name:"Novos casos",data:formatToChart(f,"new_cases")[0].data},!1),$("#estado_novoscasos").highcharts().addSeries({name:"Média móvel (7 dias)",type:"sma",linkedTo:":previous",params:{period:7},color:myColors[5],step:!0,marker:{enabled:!1},showInLegend:!0},!1),$("#estado_novoscasos").highcharts().update({yAxis:{title:{text:"Novos casos"},min:0},title:{text:"Novos casos - "+$("#sel_estado").val()},legend:{enabled:!0,labelFormatter:function(){return this.name}},exporting:{buttons:{customButton:{enabled:!1}}}},!0),createTimeColumnChart("estado_novosobitos"),$("#estado_novosobitos").highcharts().addSeries({name:"Novos óbitos",data:formatToChart(f,"new_deaths")[0].data},!1),$("#estado_novosobitos").highcharts().addSeries({name:"Média móvel (7 dias)",type:"sma",linkedTo:":previous",params:{period:7},color:myColors[5],step:!0,marker:{enabled:!1},showInLegend:!0},!1),$("#estado_novosobitos").highcharts().update({yAxis:{title:{text:"Óbitos"},min:0},title:{text:"Novos óbitos - "+$("#sel_estado").val()},legend:{enabled:!0,labelFormatter:function(){return this.name}},exporting:{buttons:{customButton:{enabled:!1}}}},!0);let C=formatToChart(dbl_time_br.filter(t=>t.location==$("#sel_estado").val()),"dbl_time","date"),v=formatDBLInterval(dbl_time_br.filter(t=>t.location==$("#sel_estado").val()),"date");createLineChart("estado_DBL"),$("#estado_DBL").highcharts().addSeries({name:"Tempo de duplicação",data:C[0]?C[0].data:[0]},!1),$("#estado_DBL").highcharts().addSeries({name:"Intervalo de Confiança",data:v[0]?v[0].data:[0],type:"arearange",lineWidth:0,fillOpacity:.2,zIndex:0,linkedTo:":previous",marker:{enabled:!1},color:myColors[0]},!1),$("#estado_DBL").highcharts().update({chart:{marginTop:65},yAxis:{title:{text:"Tempo de duplicação (dias)"},min:2,tickInterval:5},title:{text:"Tempo de duplicação"},subtitle:{text:"Calculado com base nos óbitos dos últimos 7 dias. Os ICs se referem a um nível de confiança de 95%."},tooltip:{shared:!0,valueSuffix:" dias"},exporting:{buttons:{customButton:{enabled:!1}}}}),createLineChart("estado_mortalidade"),$("#estado_mortalidade").highcharts().addSeries({name:$("#sel_estado").val(),data:formatToChart(f,"deaths_per_pop")[0].data},!1),$("#estado_mortalidade").highcharts().update({yAxis:{min:0,title:{text:"Óbitos por milhão de habitantes"}},title:{text:"Evolução da mortalidade - "+$("#sel_estado").val()}}),createLineChart("estados_casos");let w=formatToChart(estados,"total_cases"),D=$("#estados_casos").highcharts();for(i=0;i<w.length;i++)D.addSeries({name:w[i].name,data:w[i].data},!1);D.update({yAxis:{title:{text:"Casos confirmados"}},title:{text:"Casos - todos estados"},legend:{align:"center",floating:!1,verticalAlign:"bottom",layout:"horizontal",enabled:!0,labelFormatter:function(){return acronyms[this.name]}},plotOptions:{line:{marker:{enabled:!1}}},exporting:{buttons:{customButton:{onclick:function(){changeType(this,!1)}}}}}),createLineChart("estados_obitos");let T=formatToChart(estados,"total_deaths"),S=$("#estados_obitos").highcharts();for(;S.series.length>0;)S.series[0].remove(!1);for(i=0;i<T.length;i++)S.addSeries({name:T[i].name,data:T[i].data},!1);S.update({yAxis:{title:{text:"Óbitos"}},title:{text:"Óbitos - todos estados"},plotOptions:{line:{marker:{enabled:!1}}},legend:{align:"center",floating:!1,verticalAlign:"bottom",layout:"horizontal",enabled:!0,labelFormatter:function(){return acronyms[this.name]}}});let A=formatToChart(estados.filter(t=>t.total_deaths>=100),"total_deaths","day_deaths");for(createLineChart("estados_comp"),i=0;i<A.length;i++)$("#estados_comp").highcharts().addSeries({name:A[i].name,data:A[i].data},!1);$("#estados_comp").highcharts().update({yAxis:{type:"logarithmic",min:100,title:{text:"Óbitos"}},xAxis:{type:"linear",tickInterval:5,labels:{rotation:0},title:{text:"Dia"}},title:{text:"Óbitos após o 100º óbito"},legend:{align:"center",floating:!1,verticalAlign:"bottom",layout:"horizontal",enabled:!0,labelFormatter:function(){return acronyms[this.name]}},tooltip:{formatter:function(){var t='<span style="font-size: 10px">Dia '+this.x+"</span>",e=this.points||splat(this);return e.sort(function(t,e){return t.y<e.y?1:t.y>e.y?-1:0}),$.each(this.points,function(){t+='<br><span style="color:'+this.series.color+'">●</span> '+this.series.name+": <b>"+numberWithSep(this.y)+"</b> ",t+=' <span style="font-size: 10px">('+Highcharts.dateFormat("%d/%m/%Y",this.point.date)+")</span>"}),t}},exporting:{buttons:{customButton:{text:"Linear"}}}}),createLineChart("estados_mortalidade");let L=formatToChart(estados,"deaths_per_pop"),B=$("#estados_mortalidade").highcharts();for(i=0;i<L.length;i++)B.addSeries({name:L[i].name,data:L[i].data},!1);B.update({yAxis:{min:1,title:{text:"Óbitos por milhão de habitantes"}},title:{text:"Mortalidade - todos estados"},plotOptions:{line:{marker:{enabled:!1}}},legend:{align:"center",floating:!1,verticalAlign:"bottom",layout:"horizontal",enabled:!0,labelFormatter:function(){return acronyms[this.name]}}});let F=formatToChart(dbl_time_br.filter(t=>"Brasil"!=t.location),"dbl_time","date");formatDBLInterval(dbl_time_br.filter(t=>"Brasil"!=t.location),"date");for(createLineChart("estados_DBL"),i=0;i<F.length;i++){let t=F[i];$("#estados_DBL").highcharts().addSeries({name:acronyms[t.name],data:t.data},!1)}$("#estados_DBL").highcharts().update({chart:{marginTop:65},yAxis:{title:{text:"Tempo de duplicação (dias)"},min:2,tickInterval:5},title:{text:"Tempo de duplicação"},subtitle:{text:"Calculado com base nos óbitos dos últimos 7 dias.<br>Os ICs se referem a um nível de confiança de 95%."},tooltip:{shared:!0,formatter:function(){var t=this.points||splat(this);t.sort(function(t,e){return t.y<e.y?1:t.y>e.y?-1:0});var e='<span style="font-size: 10px">'+Highcharts.dateFormat("%A, %d/%m/%Y",this.x)+"</span>";return $.each(t,function(){"IC"!=this.series.name&&(e+='<br><span style="color:'+this.series.color+'">●</span> '+this.series.name+": <b>"+numberWithSep(this.y)+"</b>",e+=" (IC: "+numberWithSep(this.point.dbl_time_lwr)+" - "+numberWithSep(this.point.dbl_time_upr)+") dias")}),e}},exporting:{buttons:{customButton:{enabled:!1}}},legend:{enabled:!0}});let k=formatToChart(worldData,"total_cases","day_cases");createLineChart("world_comp");var R=$("#world_comp").highcharts();$("#sel_country").select2({matcher:matchStart}),$("#sel_country").on("select2:select",function(t){var e=t.params.data.element,a=$(e);a.detach(),$(this).append(a),$(this).select2("close"),$(this).trigger("change")});let M=[...new Set(worldData.map(t=>t.location))];for(M.forEach(function(t){$("#sel_country").append(new Option(t,t))}),$("#sel_country").val(worldCompare),$("#sel_country").change(function(){let t=$("#sel_country").val();for(;R.series.length>0;)R.series[0].remove(!1);for(i=0;i<t.length;i++){let e=k.filter(function(e){return e.name==t[i]})[0];R.addSeries({name:e.name,data:e.data},!1)}for(R.redraw();O.series.length>0;)O.series[0].remove(!1);for(i=0;i<t.length;i++){let e=j.filter(function(e){return e.name==t[i]})[0];O.addSeries({name:e.name,data:e.data},!1)}for(O.redraw(),z=getLastDate(worldData).filter(function(e){return t.includes(e.location)||"World"==e.location}),G=formatToColumnChart(z,"location","CFR"),$("#world_CFR").highcharts().series[0].remove(!1),$("#world_CFR").highcharts().addSeries({data:G.series[0].data},!1),$("#world_CFR").highcharts().update({title:{text:"Letalidade em diferentes países"},xAxis:{crosshair:!0,categories:G.order}});$("#world_CFR_comp").highcharts().series.length>0;)$("#world_CFR_comp").highcharts().series[0].remove(!1);for(i=0;i<t.length;i++){let e=N.filter(function(e){return e.name==t[i]})[0];$("#world_CFR_comp").highcharts().addSeries({name:e.name,data:e.data},!1)}$("#world_CFR_comp").highcharts().redraw(),e(t)}),i=0;i<worldCompare.length;i++){let t=k.filter(function(t){return t.name==worldCompare[i]})[0];R.addSeries({name:t.name,data:t.data},!1)}R.update({yAxis:{title:{text:"Casos confirmados"},min:100,type:"logarithmic"},xAxis:{type:"linear",tickInterval:5,labels:{rotation:0},title:{text:"Dia"},min:1},title:{text:"Casos confirmados após o 100º caso"},caption:{useHTML:!0,text:'<a href="https://ourworldindata.org/coronavirus" target="_blank">Fonte: Our World in Data</a>'},legend:{enabled:!0},tooltip:{formatter:function(){var t='<span style="font-size: 10px">Dia '+this.x+"</span>",e=this.points||splat(this);return e.sort(function(t,e){return t.y<e.y?1:t.y>e.y?-1:0}),$.each(this.points,function(){t+='<br><span style="color:'+this.series.color+'">●</span> '+this.series.name+": <b>"+numberWithSep(this.y)+"</b> ",t+=' <span style="font-size: 10px">('+Highcharts.dateFormat("%d/%m/%Y",this.point.date)+")</span>"}),t}},exporting:{buttons:{customButton:{text:"Linear"}}}});let j=formatToChart(worldData,"total_deaths","day_deaths");createLineChart("world_comp_obitos");var O=$("#world_comp_obitos").highcharts();for(i=0;i<worldCompare.length;i++){let t=j.filter(function(t){return t.name==worldCompare[i]})[0];O.addSeries({name:t.name,data:t.data},!1)}O.update({yAxis:{title:{text:"Óbitos"},min:100,type:"logarithmic"},xAxis:{type:"linear",tickInterval:5,labels:{rotation:0},title:{text:"Dia"},min:1},title:{text:"Óbitos após o 100º óbito"},caption:{useHTML:!0,text:'<a href="https://ourworldindata.org/coronavirus" target="_blank">Fonte: Our World in Data</a>'},legend:{enabled:!0},tooltip:{formatter:function(){var t='<span style="font-size: 10px">Dia '+this.x+"</span>",e=this.points||splat(this);return e.sort(function(t,e){return t.y<e.y?1:t.y>e.y?-1:0}),$.each(this.points,function(){t+='<br><span style="color:'+this.series.color+'">●</span> '+this.series.name+": <b>"+numberWithSep(this.y)+"</b> ",t+=' <span style="font-size: 10px">('+Highcharts.dateFormat("%d/%m/%Y",this.point.date)+")</span>"}),t}},exporting:{buttons:{customButton:{text:"Linear"}}}});let W=formatToChart(worldData,"weekly_cases","date");createLineChart("world_novoscasos");var I=$("#world_novoscasos").highcharts();for(i=0;i<worldCompare.length;i++){let t=W.filter(function(t){return t.name==worldCompare[i]})[0];I.addSeries({name:t.name,data:t.data},!1)}I.update({yAxis:{title:{text:"Novos casos confirmados"},min:0},xAxis:{min:Date.UTC(2020,2,1)},title:{text:"Novos casos por dia (média móvel de 7 dias)"},caption:{useHTML:!0,text:'<a href="https://ourworldindata.org/coronavirus" target="_blank">Fonte: Our World in Data</a>'},legend:{enabled:!0},plotOptions:{line:{marker:{enabled:!1}}},exporting:{buttons:{customButton:{enabled:!1}}}});let P=formatToChart(worldData,"weekly_deaths","date");createLineChart("world_novosobitos");var E=$("#world_novosobitos").highcharts();for(i=0;i<worldCompare.length;i++){let t=P.filter(function(t){return t.name==worldCompare[i]})[0];E.addSeries({name:t.name,data:t.data},!1)}E.update({yAxis:{
title:{text:"Novos óbitos confirmados"},min:0},xAxis:{min:Date.UTC(2020,2,1)},title:{text:"Novos óbitos por dia (média móvel de 7 dias)"},caption:{useHTML:!0,text:'<a href="https://ourworldindata.org/coronavirus" target="_blank">Fonte: Our World in Data</a>'},legend:{enabled:!0},plotOptions:{line:{marker:{enabled:!1}}},exporting:{buttons:{customButton:{enabled:!1}}}});let z=getLastDate(worldData).filter(function(t){return worldCompare.includes(t.location)||"World"==t.location}),G=formatToColumnChart(z,"location","CFR");createColumnChart("world_CFR"),$("#world_CFR").highcharts().addSeries({data:G.series[0].data},!1),$("#world_CFR").highcharts().update({title:{text:"Letalidade em diferentes países"},xAxis:{crosshair:!0,categories:G.order},yAxis:{title:{text:"Letalidade"},labels:{format:"{value}%"}},tooltip:{formatter:function(){var t=this.points[0].point.name,e=this.points[0].point.deaths,a=this.points[0].point.cases;return'<span style="font-size: 10px">'+t+":</span><br><b>"+numberWithSep(this.y)+"%</b> ("+numberWithSep(e)+" óbitos / "+numberWithSep(a)+" casos)"}},subtitle:{text:"Apenas alguns países que tem sido comparados ao Brasil são representados neste gráfico. Diversos países possuem letalidade nesta faixa, mas não são mostrados.<br>A coluna 'Mundo' representa a média pelo número total de casos e óbitos, e não a média das letalidades de todos países."},caption:{useHTML:!0,text:'<a href="https://ourworldindata.org/coronavirus" target="_blank">Fonte: Our World in Data</a>'}});let N=formatToChart(worldData,"CFR","day_deaths");for(createLineChart("world_CFR_comp"),i=0;i<worldCompare.length;i++){let t=N.filter(function(t){return t.name==worldCompare[i]})[0];$("#world_CFR_comp").highcharts().addSeries({name:t.name,data:t.data},!1)}$("#world_CFR_comp").highcharts().update({chart:{marginTop:50},yAxis:{title:{text:"Variação da letalidade"},labels:{format:"{value}%"}},xAxis:{type:"linear",tickInterval:5,labels:{rotation:0},title:{text:"Dia"}},title:{text:"Comparação da evolução da taxa letalidade"},subtitle:{text:"A partir do 100º óbito"},legend:{enabled:!0},tooltip:{shared:!0,formatter:function(){var t='<span style="font-size: 10px">Dia '+this.x+"</span>";return $.each(this.points,function(){t+='<br><span style="color:'+this.series.color+'">●</span> '+this.series.name+": <b>"+this.y+"%</b> ",t+=' <span style="font-size: 10px">('+Highcharts.dateFormat("%d/%m/%Y",this.point.date)+")</span>"}),t}},caption:{useHTML:!0,text:'<a href="https://ourworldindata.org/coronavirus" target="_blank">Fonte: Our World in Data</a>'},exporting:{buttons:{customButton:{enabled:!1}}}});let H=formatToChart(dbl_time,"dbl_time","date"),Y=formatToChart(dbl_time,"dbl_time","day_deaths"),V=!1,U=!1,J=formatDBLInterval(dbl_time,"date"),Q=formatDBLInterval(dbl_time,"day_deaths");for(createLineChart("world_DBL"),i=0;i<worldCompare.length;i++){let t=H.find(t=>t.name==worldCompare[i]);$("#world_DBL").highcharts().addSeries({name:t.name,data:t.data},!1)}$("#world_DBL").highcharts().update({chart:{marginTop:50,resetZoomButton:{position:{x:-250}}},yAxis:{title:{text:"Tempo de duplicação (dias)"},min:2,tickInterval:5},title:{text:"Tempo de duplicação"},subtitle:{text:"Calculado com base nos óbitos dos últimos 7 dias. Os ICs se referem a um nível de confiança de 95% e a data relativa a partir do 100º óbito."},tooltip:{shared:!0,formatter:function(){return t(this)}},exporting:{buttons:{customButton:{text:"Mostrar ICs",onclick:function(){V=!V;let t=V?"Esconder ICs":"Mostrar ICs";this.exportSVGElements[2].attr({text:t}),e($("#sel_country").val(),U)}},buttonXtype:{text:"Data relativa",onclick:function(){U=!U,e($("#sel_country").val(),U);let t=U?"Data absoluta":"Data relativa";this.exportSVGElements[4].attr({text:t})},theme:{width:80,"text-align":"center",stroke:"#000",r:6}}}},legend:{enabled:!0},caption:{useHTML:!0,text:'<a href="https://ourworldindata.org/coronavirus" target="_blank">Fonte: Our World in Data</a>'}}),console.log("Time to generate HS plots: "+((new Date).getTime()-starttimeHS)+"ms"),$("#viz1586263510113").height(660),$("#viz1586263510113").width(1140),$("#loading, #wall").hide()}var starttimeBR,starttimeW,starttimeHS,regioes={Sudeste:["São Paulo","Rio de Janeiro","Minas Gerais","Espírito Santo"],"Centro-Oeste":["Distrito Federal","Goiás","Mato Grosso","Mato Grosso do Sul"],Nordeste:["Maranhão","Piauí","Ceará","Rio Grande do Norte","Paraíba","Pernambuco","Alagoas","Sergipe","Bahia"],Sul:["Paraná","Santa Catarina","Rio Grande do Sul"],Norte:["Acre","Amazonas","Pará","Rondônia","Roraima","Amapá","Tocantins"]},acronyms={Acre:"AC",Alagoas:"AL",Amazonas:"AM",Bahia:"BA","Ceará":"CE","Distrito Federal":"DF","Espírito Santo":"ES","Goiás":"GO","Amapá":"AP","Maranhão":"MA","Mato Grosso":"MT","Mato Grosso do Sul":"MS","Minas Gerais":"MG","Paraná":"PR","Paraíba":"PB","Pará":"PA",Pernambuco:"PE","Piauí":"PI","Rio Grande do Norte":"RN","Rio Grande do Sul":"RS","Rio de Janeiro":"RJ","Rondônia":"RO",Roraima:"RR","Santa Catarina":"SC",Sergipe:"SE","São Paulo":"SP",Tocantins:"TO"},nomesEstados=Object.keys(acronyms).sort();regioes.Brasil=nomesEstados;var myColors=["#2b547e"].concat(palette("mpn65",26).map(t=>"#"+t)),highchartsOptions=Highcharts.setOptions({lang:{loading:"Aguarde...",months:["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],weekdays:["Domingo","Segunda","Terça","Quarta","Quinta","Sexta","Sábado"],shortMonths:["Jan","Feb","Mar","Abr","Maio","Jun","Jul","Ago","Set","Out","Nov","Dez"],viewFullscreen:"Ver em tela cheia",exitFullscreen:"Sair da tela cheia",printChart:"Imprimir",rangeSelectorFrom:"De",rangeSelectorTo:"Até",rangeSelectorZoom:"Periodo",downloadPNG:"Download imagem PNG",downloadJPEG:"Download imagem JPEG",downloadPDF:"Download documento PDF",downloadSVG:"Download imagem SVG",numericSymbols:null,thousandsSep:".",resetZoom:"Resetar zoom"},chart:{spacingBottom:16,zoomType:"x",resetZoomButton:{position:{x:-150,y:10},relativeTo:"chart",theme:{height:14}},panning:!0,panKey:"ctrl"},yAxis:{endOnTick:!1},title:{align:"left"},subtitle:{align:"left",y:30,margin:0},caption:{useHTML:!0,text:'<a href="https://brasil.io/covid19/" target="_blank">Fonte: Brasil.io</a>',margin:0,y:25},credits:{text:"covid19graficos.com.br",href:"http://covid19graficos.com.br",position:{x:-12}},colors:myColors});const msGetURL2="https://xx9p7hp1p7.execute-api.us-east-1.amazonaws.com/prod/PortalGeral",msGetURL="https://xx9p7hp1p7.execute-api.us-east-1.amazonaws.com/prod/PortalGeralApi";let brasilDataSource,rawBrasilData,brasilData;var loadedBrasilData=!1,loadedWorldData=!1;let rawWorldData,worldData;const worldDataSource="https://covid.ourworldindata.org/data/ecdc/full_data.csv",worldCompare=["Brasil","Estados Unidos","Índia","Rússia","Colômbia"];document.addEventListener("DOMContentLoaded",function(){dbl_time.map(t=>t.location=worldTrad[t.location]?worldTrad[t.location]:t.location),$("#sel_estado").select2({matcher:matchStart}),nomesEstados.forEach(function(t){$("#sel_estado").append(new Option(t,t))}),$("#sel_estado").val("São Paulo"),starttimeW=(new Date).getTime(),fetch(worldDataSource).then(function(t){t.text().then(function(t){rawWorldData=t,parseWorldData()})}),$.ajaxSetup({headers:{"x-parse-application-id":"unAFkcaNDeXajurGB7LChj8SgQYS2ptm"},error:function(){console.log("Erro (GET request failed): falha ao carregar dados do Brasil.io, utilizando dados em cache."),parseBrasilData(!1)}}),starttimeBR=(new Date).getTime(),parseBrasilData(!1)}),$(window).scroll(function(){$(window).width()>600&&($(window).scrollTop()>$("#br_CFR").offset().top?$("#brasil_summary").fadeOut():$("#brasil_summary").fadeIn(),$(window).scrollTop()>$("#estado_DBL").offset().top?$("#estado_summary").fadeOut():$("#estado_summary").fadeIn(),$(window).scrollTop()>$("#world_DBL").offset().top?$("#stickydiv").fadeOut():$("#stickydiv").fadeIn())});